<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Enable Edge Software Provisioner (ESP) as an OS Provider &mdash; Edge Conductor 0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Edge Conductor
          </a>
              <div class="version">
                1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Enable Edge Software Provisioner (ESP) as an OS Provider</a><ul>
<li><a class="reference internal" href="#preparation">Preparation</a></li>
<li><a class="reference internal" href="#edge-conductor-kit-enabling-esp">Edge Conductor Kit Enabling ESP</a></li>
<li><a class="reference internal" href="#preconditions">Preconditions</a></li>
<li><a class="reference internal" href="#init-edge-conductor-environment">Init Edge Conductor Environment</a></li>
<li><a class="reference internal" href="#build-esp-as-os-provider">Build ESP as OS provider</a></li>
<li><a class="reference internal" href="#start-esp-services">Start ESP Services</a></li>
<li><a class="reference internal" href="#os-provisioning-for-nodes">OS Provisioning for Nodes</a></li>
<li><a class="reference internal" href="#stop-esp-services">Stop ESP Services</a></li>
<li><a class="reference internal" href="#clean-up-esp-codebase">Clean up ESP Codebase</a></li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Edge Conductor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Enable Edge Software Provisioner (ESP) as an OS Provider</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/guides/os-provider-esp.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="enable-edge-software-provisioner-esp-as-an-os-provider">
<h1>Enable Edge Software Provisioner (ESP) as an OS Provider<a class="headerlink" href="#enable-edge-software-provisioner-esp-as-an-os-provider" title="Permalink to this heading"></a></h1>
<p>This document describes how to configure and enable Edge Software Provisioner (ESP) as an OS provider.</p>
<ul class="simple">
<li><p><a class="reference internal" href="#preparation"><span class="std std-doc">Preparation</span></a></p></li>
<li><p><span class="xref myst">Top Config</span></p></li>
<li><p><span class="xref myst">Custom Config</span></p></li>
<li><p><span class="xref myst">Prepare ESP Config</span></p></li>
<li><p><a class="reference internal" href="#init-edge-conductor-environment"><span class="std std-doc">Init Edge Conductor Environment</span></a></p></li>
<li><p><a class="reference internal" href="#build-esp-as-os-provider"><span class="std std-doc">Build ESP as OS provider</span></a></p></li>
<li><p><span class="xref myst">Start and Stop ESP Services</span></p></li>
<li><p><a class="reference internal" href="#clean-up-esp-codebase"><span class="std std-doc">Clean up ESP Codebase</span></a></p></li>
</ul>
<section id="preparation">
<h2>Preparation<a class="headerlink" href="#preparation" title="Permalink to this heading"></a></h2>
<p>Read <a class="reference external" href="https://github.com/intel/edge-software-provisioner">ESP Document</a>, especially the <a class="reference external" href="https://github.com/intel/edge-software-provisioner#network-setup">Network Setup</a>, and prepare the hardware and network.</p>
<blockquote>
<div><p><em>NOTE:</em>  To run ESP on Day-0 machine, 2 CPUs, 20GB HD and 2GB of RAM are needed additionally. See <a class="reference external" href="https://github.com/intel/edge-software-provisioner#prerequisites">ESP Prerequisites</a>.</p>
</div></blockquote>
<p>Follow <span class="xref myst">Build-and-Install-Edge-Conductor-Tool</span> to build and install Edge Conductor tool.
Enter <code class="docutils literal notranslate"><span class="pre">_workspace</span></code> folder to run Edge Conductor tool.</p>
</section>
<section id="edge-conductor-kit-enabling-esp">
<h2>Edge Conductor Kit Enabling ESP<a class="headerlink" href="#edge-conductor-kit-enabling-esp" title="Permalink to this heading"></a></h2>
<p>Some of the Edge Conductor Kits enabled ESP as the os-provider, with these Kits, users can run os-deploy commands.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>kit/
├── capi_byoh.yml
└── rke_ubuntu_20.04.yml
</pre></div>
</div>
<p>A section for <code class="docutils literal notranslate"><span class="pre">OS</span></code> as shown in the following example is added to these Kits to specify the OS provider as ESP.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">OS</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">manifests</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;config/manifests/os_provider_manifest.yml&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">esp</span><span class="w"></span>
<span class="w">  </span><span class="c1"># Before running &quot;init&quot; with this Kit config file, please update ESP config</span><span class="w"></span>
<span class="w">  </span><span class="c1"># with correct &quot;git_username&quot; and &quot;git_token&quot; to access the profile git repo.</span><span class="w"></span>
<span class="w">  </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;config/os-provider/esp_config_profile-ubuntu-20.04.yml&quot;</span><span class="w"> </span>
</pre></div>
</div>
</section>
<section id="preconditions">
<h2>Preconditions<a class="headerlink" href="#preconditions" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>Users need to setup the ESP network topologic following the settings in <span class="xref myst">ESP Network Settings</span>, and connect all the nodes to be installed to the ESP network. All the nodes should be able to boot from the ESP network (enter Boot Menu and select to boot from PXE via the ESP network).</p></li>
<li><p>Before running the “init” command, users need to:</p>
<ul>
<li><p>Input the MAC addresses and static IP addresses of the nodes in the “Parameters - nodes” config section.</p></li>
</ul>
</li>
<li><p>About offline installation: ESP profile provided by Edge Conductor will download all packages needed by OS provisioning and cluster deployment.</p>
<ul>
<li><p>If users want to install additional applications, they need to install from official apt mirror via external network.</p></li>
</ul>
</li>
</ul>
</section>
<section id="init-edge-conductor-environment">
<h2>Init Edge Conductor Environment<a class="headerlink" href="#init-edge-conductor-environment" title="Permalink to this heading"></a></h2>
<p>Run the “init” commands to initialize the Edge Conductor environment with the Edge Conductor Kit config with OS provider set as ESP.</p>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">conductor</span> <span class="n">init</span> <span class="o">-</span><span class="n">c</span> <span class="n">kit</span><span class="o">/</span><span class="n">rke_ubuntu_20</span><span class="mf">.04</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
</section>
<section id="build-esp-as-os-provider">
<h2>Build ESP as OS provider<a class="headerlink" href="#build-esp-as-os-provider" title="Permalink to this heading"></a></h2>
<p>Run the following command to build ESP.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">conductor</span> <span class="n">os</span><span class="o">-</span><span class="n">deploy</span> <span class="n">build</span>
</pre></div>
</div>
</section>
<section id="start-esp-services">
<h2>Start ESP Services<a class="headerlink" href="#start-esp-services" title="Permalink to this heading"></a></h2>
<p>After <code class="docutils literal notranslate"><span class="pre">./conductor</span> <span class="pre">os-deploy</span> <span class="pre">build</span></code> finishes, the ESP codebase and build result will be under <code class="docutils literal notranslate"><span class="pre">runtime/esp</span></code>.</p>
<blockquote>
<div><p><em>NOTE:</em>  DO NOT delete the folder <code class="docutils literal notranslate"><span class="pre">runtime/esp</span></code> manually.</p>
</div></blockquote>
<blockquote>
<div><p><em>NOTE:</em>  DO NOT run <code class="docutils literal notranslate"><span class="pre">./conductor</span> <span class="pre">os-deploy</span> <span class="pre">cleanup</span></code> when ESP services are still running.</p>
</div></blockquote>
<blockquote>
<div><p><em>NOTE:</em>  DO NOT run <code class="docutils literal notranslate"><span class="pre">./conductor</span> <span class="pre">deinit</span></code> before you have stopped ESP services and cleaned the ESP codebase.</p>
</div></blockquote>
<p>Run the following commands to start ESP services:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">conductor</span> <span class="n">os</span><span class="o">-</span><span class="n">deploy</span> <span class="n">start</span>
</pre></div>
</div>
</section>
<section id="os-provisioning-for-nodes">
<h2>OS Provisioning for Nodes<a class="headerlink" href="#os-provisioning-for-nodes" title="Permalink to this heading"></a></h2>
<p>Boot the nodes from the ESP network and select the OS profile to be installed.</p>
<p>Wait until the OS provisioning finished.</p>
</section>
<section id="stop-esp-services">
<h2>Stop ESP Services<a class="headerlink" href="#stop-esp-services" title="Permalink to this heading"></a></h2>
<p>After all edge nodes are provisioned, run the following command to stop ESP services:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">conductor</span> <span class="n">os</span><span class="o">-</span><span class="n">deploy</span> <span class="n">stop</span>
</pre></div>
</div>
<blockquote>
<div><p><em>NOTE:</em>  There might be “Device or resource busy” error after this step when doing cleanup or build ESP for the 2nd time. This is ESP known issue, please refer to <a class="reference external" href="https://github.com/intel/Edge-Software-Provisioner/issues/5">ESP issue #5</a>. To workaround this issue, please manually umount the busy locations, then do <code class="docutils literal notranslate"><span class="pre">os-deploy</span> <span class="pre">cleanup</span></code> again.</p>
</div></blockquote>
</section>
<section id="clean-up-esp-codebase">
<h2>Clean up ESP Codebase<a class="headerlink" href="#clean-up-esp-codebase" title="Permalink to this heading"></a></h2>
<p>Run the following commands to clean up ESP codebase and file system.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">conductor</span> <span class="n">os</span><span class="o">-</span><span class="n">deploy</span> <span class="n">cleanup</span>
</pre></div>
</div>
<p>After this, you can run the <code class="docutils literal notranslate"><span class="pre">deinit</span></code> command to stop Edge Conductor services.</p>
<p>Copyright (c) 2022 Intel Corporation</p>
<p>SPDX-License-Identifier: Apache-2.0</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Intel.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>